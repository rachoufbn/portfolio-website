volumes:
    caddy-data:
    caddy-config:

networks:
    proxy:

services:

    # Caddy reverse proxy for handling HTTPS/SSL termination
    caddy:
        image: caddy:2-alpine
        volumes:
            - ./Caddyfile:/etc/caddy/Caddyfile:ro
            - caddy-data:/data
            - caddy-config:/config
        ports:
            - '80:80'
            - '443:443'
        networks:
            - proxy
        restart: unless-stopped

    webserver:
        image: portfolio-website-webserver:latest # Image name for deployment
        build:
            context: .
            dockerfile: Dockerfile
        # On local, we override the command and run flask dev server
        command: "flask run --host=0.0.0.0 --port=80 --debug --reload"
        # On local, mount source code for quick iteration
        volumes:
            - ./src:/app
        environment:
            MEETING_NOTES_BOT_DB_PATH: /app/databases/portfolio-website.db
            ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
            # Python optimizations
            PYTHONDONTWRITEBYTECODE: 1
            PYTHONUNBUFFERED: 1
            # Local Only - Flask settings
            FLASK_APP: main.py
        networks:
            - proxy
        restart: always
