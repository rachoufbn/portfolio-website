# This override file is for local development environment
# - It mounts source code into the webserver container for easy iteration
# - It exposes MySQL port for external access
# - It runs Flask development server instead of gunicorn
# - It uses Caddy as a reverse proxy for local HTTPS support
# Used with: `docker compose`, this override is applied automatically

volumes:
    caddy-data:
    caddy-config:

networks:
    proxy:

services:

    caddy:
        image: caddy:2-alpine
        volumes:
            - ./Caddyfile:/etc/caddy/Caddyfile:ro
            - caddy-data:/data
            - caddy-config:/config
        ports:
            - '80:80'
            - '443:443'
        networks:
            - proxy
        restart: unless-stopped

    webserver:
        volumes:
            - ./src:/app # On local, mount source code for quick iteration
        environment:
            - FLASK_APP=main.py
        command: "flask run --host=0.0.0.0 --port=80 --debug --reload" # On local, we override the command and run flask dev server
        networks:
            - proxy

    db:
        ports:
            # Expose MySQL port for external access
            - '3306:3306'